---
params:
  boj: 1221
  bojTitle: 가까운 점
---

## 문제 내용

3차원 공간에 점 $N$개가 주어집니다. 중복을 제거한 다음, 남은 점들 간에 가장 가까운 두 점 사이의 거리의 제곱을 구하고,
그러한 거리를 갖는 두 점의 쌍의 개수도 구하여 출력하세요.

점의 좌표의 범위는 $-10^6$ 이상 $10^6$ 이하이며, 점의 개수는 최대 $150\,000$개입니다.

## 문제 풀이

{{% details title="스포일러" closed="true" %}}

[진한님의 블로그 글](https://archive.md/fFdGR)에서처럼 2차원 상의 가장 가까운 두 점 알고리즘을 확장한 풀이가 의도한 풀이로 추정됩니다.

{{% /details %}}

{{% details title="별해" closed="true" %}}

그러나 스위핑을 하지 않고 해결하는 방법도 존재합니다.

$d$의 값을 고정하고 전체 공간을 $d \times d \times d$의 상자로 나눈다고 생각해 봅시다. 어떤 상자에 두 개의 점이 존재한다면, 그 두 점 사이의 거리의 제곱은 최대 $3(d-1)^2$입니다. 그렇다면 그 거리를 초과하는 두 점의 쌍은 더 이상 볼 필요가 없고, 상자 단위의 좌표가 한 방향으로 3 이상 차이나는 쌍도 볼 필요가 없습니다.

그러한 $d$값을 구하기 위해, $d=1$에서 시작해서 하나의 상자에 둘 이상의 점이 들어갈 때까지 $d$를 2배로 증가시켜 줍니다. 그러한 $d$를 찾았으면 그 시점에서 각각의 상자에 들어가는 점들의 목록을 map으로 만듭니다.

이제, 점이 존재하는 각각의 상자에 대해, 상자 내에서 두 점을 골라서 찾은 최단 거리를 확인하고, 각 상자를 중심으로 가로, 세로, 높이, 방향으로 2칸 이내의 상자들의 점들과의 거리를 모두 확인해주면 됩니다. 시간이 조금 빡빡하므로 다른 상자를 확인할 때는 자신보다 사전순으로 뒤에 있는 상자들만 보는 최적화를 추가해 줍니다.

{{% /details %}}