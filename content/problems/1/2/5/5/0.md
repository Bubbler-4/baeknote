---
params:
  boj: 12550
  bojTitle: Travel Plan (Large)
---

## 문제 내용

일직선 위에 $N$개의 점이 있습니다. 각 점의 좌표는 정수입니다. 당신은 1번 점 위에 있으며, 1번 점의 위치는 0입니다.

당신은 다른 모든 점을 한 번씩 방문하고 1번 점으로 돌아오려고 합니다. 어떤 점을 방문하지 않고 지나칠 수도 있으나, 방향 전환(앞-뒤 또는 뒤-앞)은 어떤 점을 방문했을 때만 가능합니다.

그러한 방법들 중 총 이동 거리가 $F$ 이하이면서 가능한 한 최대인 것의 이동 거리를 구하세요.

### 입력

첫 줄에는 테스트 케이스의 개수 $T$가 주어집니다. ($1 \le T \le 20$)

각 테스트 케이스에 대해, 첫 줄에는 점의 개수 $N$이, 두 번째 줄에는 각 점의 위치 $X_i$가 주어집니다. 모든 점의 위치는 서로 다르며, $X_1$은 0입니다. ($2 \le N \le 30$, $-10^{15} \le X_i \le 10^{15}$)

세 번째 줄에는 거리 제한을 나타내는 값 $F$가 주어집니다. ($1 \le F \le 10^{17}$)

### 출력

각 테스트 케이스에 대해 `Case #{테스트 케이스 번호}: {문제의 정답}`의 형식으로 출력합니다. 총 이동 거리가 $F$ 이하인 경로가 단 하나도 없다면 `NO SOLUTION`을 정답 대신 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

이 문제를 풀기 위해서는 다음과 같은 아이디어가 필요합니다.

* 일반성을 잃지 않고, 각 점의 위치가 오름차순으로 정렬되어 있다, 즉 $X_i < X_{i+1}$이 항상 성립한다고 가정합니다.
* 맨 왼쪽 점과 맨 오른쪽 점을 제외하고, 각 점에서는 왼쪽으로 두 번 연결되거나, 오른쪽으로 두 번 연결되거나, 양쪽으로 한 번씩 연결될 수 있습니다.
* 그러면 $i$번째 점의 직전을 기준으로 연결 요소의 개수가 $k$개라면, $i$번째 점 직후로는 각각 $k-1$개, $k+1$개, 또는 $k$개가 됩니다.
* 또한, $i$번째 점 직후의 연결 요소가 $k'$개라면, 여기서부터 $i+1$번째 점까지 각각의 연결 요소에 의해 전체 거리에 $2(X_{i+1} - X_{i})$만큼이 더해집니다.

이를 이용하여 왼쪽부터 오른쪽까지 가능한 모든 거리를 모으기를 반복하면 $\mathcal{O} (3^{N})$의 풀이를 얻습니다.

$N$이 최대 30이므로 meet in the middle을 추가할 수 있습니다.

* 점의 구간을 절반으로 나눠서 (그 경계를 $m$번 점이라고 합시다), 왼쪽 절반과 오른쪽 절반에 대해 각각 위의 과정을 수행하여 양쪽에 대해 $m$번 점 직전에서 연결 요소의 개수별로 가능한 거리의 목록을 구합니다.
* 이제 $m$번 점을 기준으로 양쪽을 연결해야 합니다. 이때 다음과 같은 경우가 있습니다.
  * $m$번 점에서 왼쪽과 오른쪽으로 한 번씩 연결될 경우, 양쪽의 연결 요소의 개수는 같습니다.
  * $m$번 점에서 왼쪽으로 두 번 연결될 경우, 오른쪽의 연결 요소의 개수가 1 작습니다.
  * $m$번 점에서 오른쪽으로 두 번 연결될 경우, 왼쪽의 연결 요소의 개수가 1 작습니다.
* 이제 각각의 가능한 연결 요소 개수의 쌍에 대해, 양쪽의 가능한 거리들을 정렬한 뒤 이분 탐색 또는 투 포인터를 사용하여 거리 합이 $F$ 이하인 것 중 최대인 것을 찾으면 됩니다.

{{< /details >}}
