---
params:
  boj: 12622
  bojTitle: 문제 제목
---

## 문제 내용

소코반을 변형한 게임을 최소 횟수의 박스 이동으로 해결하세요.

이 게임의 목표는 박스를 밀어 옮겨서 모든 박스를 목적지로 옮기는 것입니다. 하나의 박스는 위와 아래로 이웃한 칸들이 모두 비어 있을 때 위나 아래로 한 칸 밀 수 있고,
마찬가지로 왼쪽과 오른쪽으로 이웃한 칸들이 모두 비어 있을 때 왼쪽이나 오른쪽으로 한 칸 밀 수 있습니다.

박스가 상하좌우로 모두 연결된 상태를 안정 상태, 그렇지 않은 상태를 불안정 상태라고 합니다. 불안정 상태에서는 하나의 상자를 이동하여 반드시 안정 상태로 만들어야 합니다.

### 입력

첫 줄에는 테스트 케이스의 개수 $T$가 주어집니다. ($1 \le T \le 50$)

각 테스트 케이스에 대해, 먼저 게임판의 행 개수 $R$과 열 개수 $C$가 주어지고, 그 다음 $R$줄에 걸쳐서 게임판의 초기 상태가 주어집니다. ($1 \le R, C \le 12$)

* `.`: 빈 공간
* `#`: 벽
* `x`: 목표 지점, 빈 공간
* `o`: 박스가 있는 공간
* `w`: 목표 지점이면서 박스가 있는 공간

시작 상태와 목표 상태 모두 안정 상태임이 보장됩니다. 박스의 개수는 1개 이상 5개 이하입니다.

### 출력

각 테스트 케이스에 대해 `Case #<케이스 번호>: <최소 이동 횟수>`의 형식으로 출력합니다. 어떻게 해도 목표 상태를 만들 수 없다면 최소 이동 횟수 대신 `-1`을 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

불안정 상태에 주의하면서 모든 박스의 위치의 목록을 상태로 두고 BFS를 하면 됩니다. 박스가 여러 개이므로 안정 상태를 판별하기 위한 그래프 탐색을 별도로 구현해야 합니다.
박스 좌표의 리스트로 상태를 저장하는 경우, 순서만 다른 것을 같은 상태로 처리하기 위해 좌표들을 정렬해 줍니다.

안정 상태인 박스 5개의 가능한 상태의 개수는 최대 1만개 정도이며, 안정 상태에서 박스를 하나 밀어서 얻을 수 있는 불안정 상태를 포함하더라도 20만 개를 넘지 않습니다.

{{< /details >}}
