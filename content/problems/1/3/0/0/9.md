---
params:
  boj: 13009
  bojTitle: 특수 능력 2
---

## 문제 내용

$N$개의 정점과 $M$개의 **유향 간선**으로 이루어진 그래프가 주어집니다. 정점은 1번부터 $N$번까지 번호가 매겨져 있습니다. 각 간선의 비용은 **음이 아닌 정수**입니다. 이 그래프는 multiple edge나 self loop을 포함할 수도 있습니다.

기본적으로 어떤 간선을 통해 이동하면 그 간선의 비용을 총 비용에 더해야 하지만, 대신 **그 간선의 비용을 총 비용에서 빼는** 행동을 최대 $C$번 할 수 있습니다. 이때 1번 정점에서 $N$번 정점으로 가는 최소 비용을 계산하세요. 이러한 경로가 존재하는 입력만 주어집니다.

## 문제 풀이

{{% details title="스포일러" closed="true" %}}

이 문제는 [Min-plus matrix multiplication](https://en.wikipedia.org/wiki/Min-plus_matrix_multiplication)을 이용하여 풀 수 있습니다. 일반적인 행렬곱은 경로의 개수를 구하지만, 이러한 변형 행렬곱을 사용하면 최단 경로의 비용을 구할 수 있습니다.

원래 그래프에서 1회 이동할 때 발생하는 비용을 나타내는 행렬을 $D$, 특수행동으로 1회 이동할 때 발생하는 비용을 나타내는 행렬을 $A$라고 합시다. $D[i][j]$는 $i$에서 $j$로 가는 간선이 있을 경우 그 간선들의 비용 중 최솟값, 없을 경우 inf로 정의합니다. 제자리에서 움직이지 않는 것도 허용하기 위해 $D[i][i]$는 0으로 둡니다.

$A[i][j]$도 간선의 비용의 부호만 뒤집어서 동일하게 구성합니다. $A[i][i]$는 self loop가 있을 경우 그 간선들의 음의 비용 중 최솟값을 적습니다.

이제 원하는 최소 비용의 값은 $D$를 따라 충분히 많이 이동하고 $A$로 한번 이동하고, ..., $D$를 따라 충분히 많이 이동한 결과가 됩니다. 그런데 Dijkstra 알고리즘의 원리에 의해 $N$회를 초과하여 $D$를 따라서만 이동하는 것은 영향이 없으므로, "충분히 많이 이동"을 $N$회 이동으로 대체할 수 있습니다.

따라서 구하고자 하는 결과는 $(D^N A)^C D^N$과 동일하며, 이는 연산의 종류만 바꾼 행렬 거듭제곱 알고리즘으로 구할 수 있습니다.

{{% /details %}}
