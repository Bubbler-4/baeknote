---
params:
  boj: 13130
  bojTitle: FunctionCup
---

## 문제 내용

생략

* 실제 입력되는 $N$의 범위는 $1 \le N \le 16$입니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

먼저, 문제의 조건을 모두 충족하려면 함수 $f$에 의해 만들어지는 함수형 그래프가 사이클로만 이루어져 있어야 합니다. 그렇지 않으면 어떤 수 $x$에 대해 $f^i(x) = x$인 $i > 0$이 존재하지 않습니다.

그리고, 수 $i$가 길이 $k$의 사이클에 포함되려면 $A_i$가 $k$의 배수여야 합니다. 이 조건을 모든 $i$와 모든 $k$에 대해 미리 판별해 놓고, 각각의 $k$에 대해 가능한 $i$들의 집합을 비트마스크로 만들어 둡니다.

또한, 크기 $k$의 어떤 수들의 집합이 길이 $k$의 사이클이 되도록 하는 방법은 $(k-1)!$가지가 있습니다. 이는 가장 작은 원소 $x$에서 시작하여 $f(x)$를 고르고, 그 다음 $f^2(x)$를 고르고, ...를 반복하여 얻을 수 있습니다.

이제 경우의 수를 세는 비트DP를 수행합니다. 크기 $N$의 전체집합을 여러 개의 사이클로 나누었을 때 여러 번 세어지지 않도록, 아직 사용되지 않은 첫 번째 비트를 포함하는 집합만을 고려합니다.
아직 사용되지 않은 첫 번째 비트를 반드시 포함하고 아직 사용되지 않은 비트들의 집합만을 순회하도록 구현하면 연산량은 $15 \times 3^{15}$가 됩니다.

전체에서 첫 번째 비트가 비어있는 경우는 아직 아무것도 사용하지 않았을 때 뿐이므로 이 케이스를 따로 처리해 주면 $14 \times 3^{14}$로 줄일 수 있고,
3진법 순회 대신 재귀적으로 모든 전파를 구성하는 방법을 사용하면 $N$을 뗄 수 있습니다.

{{< /details >}}
