---
params:
  boj: 14255
  bojTitle: 멋진 배열
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

문제의 조건을 단순화하면 모든 $r_1, c_1, r_2, c_2$에 대해 $A[r_1][c_1] + A[r_2][c_2] = A[r_1][c_2] + A[r_2][c_1]$임과 동치입니다. 이를 바꿔 표현하면 다음을 얻을 수 있습니다.

$$
\begin{align*}
A[r_1][c_1] - A[r_1][c_2] = A[r_2][c_1] - A[r_2][c_2] = \Delta_{c_1, c_2} \\
A[r_1][c_1] - A[r_2][c_1] = A[r_1][c_2] - A[r_2][c_2] = \Delta_{r_1, r_2}
\end{align*}
$$

따라서 배열 $A$는 하나의 원소와 $N-1$개의 가로 방향 차이, 그리고 $N-1$개의 세로 방향 차이에 의해 유일하게 결정됩니다.

같은 가로줄 $r$에 두 개의 수가 세로줄 $c_1$과 $c_2$에 주어져 있다면, 하나의 가로 방향 차이가 정해집니다. 이를 통해 $A[r'][c_1]$이나 $A[r'][c_2]$ 중 하나를 알고 있다면 다른 하나를 결정할 수 있습니다.
이때 음수가 나오거나 이미 채워져 있는 두 수의 차이가 맞지 않다면 경우의 수는 0이 됩니다.
그리고 나면 두 세로줄 중 하나를 지워도 되는데, 값이 더 작은 쪽을 남겨야 음수로 인한 모순을 방지할 수 있습니다.

가로와 세로를 바꿔서 똑같이 처리해 주고 나면, 답이 무한대가 아니라는 조건에 의해 모든 칸이 빈 줄은 있을 수 없기 때문에, 모든 가로줄과 모든 세로줄에는 정확히 하나의 수가 남게 됩니다.
가로줄이나 세로줄의 순서를 적절히 바꿔서 남아있는 수들을 모두 대각선에 놓고 나서, 맨 왼쪽 위의 $2 \times 2 $ 영역을 생각해 봅시다.

$$
\begin{bmatrix}
A[1][1] & y \\
x & A[2][2]
\end{bmatrix}
$$

여기서 $x$에 들어갈 수에 따라 $y$가 정해지며, 이들을 채워 넣으면 둘 중 하나의 행과 둘 중 하나의 열을 지울 수 있습니다. 그 결과 맨 왼쪽 위에 남는 수는 네 수 중 최솟값이 됩니다.
배열의 대각선 상의 나머지 수는 건드리지 않았으므로, $i$번째 가로/세로줄에서 시작하면서 맨 왼쪽 위 칸이 $k$인 배열의 개수를 DP로 구할 수 있습니다.

{{< /details >}}
