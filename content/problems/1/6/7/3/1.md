---
params:
  boj: 16731
  bojTitle: JackRabbit Slim
---

## 문제 내용

$n$개의 당근이 각각 $x_1, x_2, \cdots, x_n$의 위치에 떨어져 있습니다. 당신은 이 당근을 다음의 방법으로 주우려고 합니다.

* $x_i$의 위치에서 시작하여, 먼저 $i$번째 당근을 줍습니다.
* 그 다음 양쪽에 놓인 당근 중에서 가장 가까운 것이 있는 곳으로 가서 그 당근을 줍는 것을 반복합니다. 가장 가까운 것이 두 개일 경우, 오른쪽에 있는 당근을 선택합니다.

모든 $i = 1, 2, \cdots, n$에 대해 결과적으로 이동할 거리의 총합을 구하세요.

### 입력

첫 줄에 $n$이 주어집니다. ($1 \le n \le 100\;000$)

다음 줄에 $x_1, x_2, \cdots, x_n$이 주어집니다. ($0 \le x_i \le 10^9$) 모든 당근의 위치는 서로 다르며, 오름차순으로 주어집니다.

### 출력

문제의 정답을 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

각각의 시작점에 대해, 모든 당근을 줍는 동안 방향을 바꾸는 횟수는 최대 약 $\log_2 10^9 \approx 30$번입니다. 따라서 방향을 바꾸는 지점을 효율적으로 구하고 이를 이용하여 총 이동거리를 구한다면 시간 내에 통과할 수 있을 것입니다.

이를 효율적으로 구하기 위해, 방향을 바꿀 조건을 구해 봅시다. 왼쪽으로 가다가 오른쪽으로 가는 경우, 다음의 상황으로 볼 수 있습니다. $i$번째부터 $j-1$번째까지의 당근을 모두 주웠고, 현재 $x_i$의 위치에 있으며,
$x_k$까지 갔다가 방향을 바꿔서 $x_j$로 이동하려고 하는 상황입니다.

```
x_{k-1} x_k .. x_i ..(empty).. x_j
```

이때 오른쪽 거리가 왼쪽 거리 이하여야 하므로, $x_j - x_k \le x_k - x_{k-1}$ 입니다. 식을 정리하면 $2x_k - x_{k-1} \ge x_j$가 됩니다. 따라서 가능한 모든 $k$들에 대해 $2x_k - x_{k-1}$을 계산해 두고,
인덱스가 $i$ 이하이면서 그 값이 $x_j$ 이상인 가장 오른쪽 인덱스 $k$를 찾으면 됩니다.

이는 세그먼트 트리 위에서의 이분 탐색으로 구할 수 있습니다. 탐색하고 싶은 구간이 세그먼트 트리 전체가 아니므로, 주어진 구간을 세그먼트 트리의 노드의 조합으로 표현합니다.
그 노드들 중에서 값이 $x_j$ 이상인 가장 오른쪽 노드를 구한 뒤, 이 노드에서 이분 탐색을 진행하면 $\mathcal{O}(\log n)$에 쿼리를 처리할 수 있습니다.

오른쪽으로 가다가 왼쪽으로 가는 경우도 같은 방법으로 세그먼트 트리를 구성하여 처리할 수 있습니다. $x_1$이나 $x_n$을 주운 뒤에는 $x_n - x_1$을 더하고 종료하는 등 종료 조건에도 신경을 써야 합니다.

{{< /details >}}
