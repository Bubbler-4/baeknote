---
params:
  boj: 17121
  bojTitle: 골드바흐 삼각형
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

먼저, BOJ 17105 골드바흐 트리플의 풀이를 이용하여 합이 $N$인 세 소수의 쌍의 개수를 모두 구합니다. 이때 17105와 다른 점은 모든 소수가 홀수여야 한다는 것이고,
이를 이용하여 짝수 위치의 원소들을 모두 제거하여 상수를 줄일 수 있습니다. 이 문제의 시간 제한이 굉장히 빡빡하기 때문에, TLE를 받지 않으려면 이러한 최적화가 필요합니다.

이제 여기서 **삼각형을 이루지 않는** 소수의 쌍의 개수를 빼야 합니다. 세 소수를 $a \le b \le c$라고 할 때, $a + b \le c$인 쌍이 여기에 해당됩니다.
$a+b$의 값이 같은 서로 다른 쌍의 개수를 미리 구해 놓으면 (이는 골드바흐 트리플 풀이 과정에서 구해야 하는 "두 소수의 합으로 나타내는 방법의 수" 배열의 각 원소 $x$를 $\left\lceil\frac{x}{2}\right\rceil$로
바꾸면 됩니다), 다음과 같은 모양의 곱들의 합을 구해야 하는 문제가 됩니다. (합쳐져야 하는 위치들을 같은 번호로 나타내었습니다.)

```none
  | 1  3  5  7  9  11 13 15 17
--+----------------------------
2 |    1  2  3  4  5  6  7  8
4 |       3  4  5  6  7  8  9
6 |          5  6  7  8  9  10
8 |             7  8  9  10 11
10|                9  10 11 12
12|                   11 12 13
```

이는 한 번의 FFT로 답이 구해지는 형태가 아니지만, 다음과 같이 분할 정복으로 총 $\mathcal{O}(N \log^2 N)$ 시간에 구할 수 있습니다.

* 위의 삼각형 영역에서 만들 수 있는 가장 큰 정사각형을 선택합니다. 편의상 각 배열의 길이를 2의 거듭제곱으로 두면, $2^{18} \times 2^{18}$ 영역 하나를 만들 수 있습니다.
* 이 영역의 곱의 대각 합들을 FFT로 구하고, 최종 정답 배열의 적절한 위치에 각각의 값들을 더해 줍니다.
* 남은 두 개의 삼각형 영역에서 각각 $2^{17} \times 2^{17}$ 크기의 정사각형을 선택하여 FFT를 하고, ... 위의 과정을 반복합니다.

{{< /details >}}
