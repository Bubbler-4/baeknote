---
params:
  boj: 1733
  bojTitle: 등번호
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

Hopcroft-Karp를 돌리면 아슬아슬하게 될 것처럼 생겼지만 강한 데이터가 추가되었기 때문에 TLE를 받을 가능성이 높습니다.

대신에 다음과 같이 그래프를 정의하고 재귀 DFS를 하여 문제를 풀 수 있습니다.

* 각 사람을 간선으로, 각 번호를 정점으로 하는 그래프를 만듭니다. 몇몇 간선은 self loop일 수도 있습니다.
* 이제 한 정점에서 시작하여 정점과 간선의 번호를 기록해가며 DFS를 수행합니다.
* DFS 도중에 사이클을 찾았다면 (현재 간선의 다음 정점이 이미 방문한 정점인 경우), 현재 간선에 마지막으로 방문한 중복되지 않은 정점을 매칭하고 루트까지 돌아오면서 역순으로 매칭하는 것을 반복합니다.
  그러면서 거쳐오는 각 정점에 대해, 아직 처리되지 않은 이웃 간선들의 양 끝점을 모두 아직 방문하지 않은 쪽의 정점 번호로 바꿉니다. 그 간선이 self loop였다면 답은 존재하지 않습니다.
* DFS 도중에 리프를 찾았다면 (현재 정점에서 더 이상 나갈 간선이 없음), 현재 정점에 마지막 간선을 매칭하고 직전 정점으로 돌아갑니다.

문제의 조건 하에서 완전 매칭이 존재할 조건은 각 연결 요소에 사이클이 0개이거나 1개임과 동치이며, 모든 경우 위의 과정으로 올바른 답(매칭 또는 불가능 출력)을 구할 수 있음을 보일 수 있습니다.

{{< /details >}}
