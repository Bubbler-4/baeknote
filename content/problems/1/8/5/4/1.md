---
params:
  boj: 18541
  bojTitle: Milliarium Aureum
---

## 문제 내용

로마 제국에는 $n$개의 도시가 있으며, 그 중 하나는 로마라고 알려져 있으나 어느 도시가 로마인지는 모릅니다.

이 도시들은 $m$개의 도로로 연결되어 있습니다. 그 중에 $n-1$개의 도로는 **주 도로**(major road)이며, 이들은 그래프의 스패닝 트리를 이룹니다. 나머지 도로는 **부 도로**입니다.

각 도로는 어떤 폭을 가집니다. 어떤 경로의 폭은 그 경로가 거치는 모든 도로의 폭 중에서 최솟값입니다. "모든 길은 로마로 통하기" 때문에, 로마에서 주 도로만을 이용하여 임의의 도시로 이동하는 경로의 폭은
다른 임의의 도로를 이용하여 그 도시로 이동하는 경로의 폭보다 절대 작지 않습니다.

$n$개의 도시 중 로마가 될 수 있는 도시의 목록을 출력하세요. 적어도 하나의 도시는 위의 조건을 충족합니다.

### 입력

첫 줄에는 $n$과 $m$이 주어집니다. ($1 \le n, m \le 10^5$)

다음 $m$줄에는 각 도로의 정보가 $t_i, u_i, v_i, w_i$의 순서로 주어집니다. 이는 다음을 의미합니다.

* 도시 $u_i$와 도시 $v_i$를 잇는 양방향 도로가 있으며, 이 도로의 폭은 $w_i$입니다. $t_i = 1$이면 이 도로는 주 도로이며, $0$이면 부 도로입니다.

같은 도시의 쌍을 잇는 여러 개의 도로가 있을 수도 있고, 한 도시에서 자기 자신으로 연결되는 도로도 있을 수 있습니다. 주 도로들은 스패닝 트리를 이룸이 보장됩니다.

### 출력

첫 줄에는 로마가 될 수 있는 도시의 개수를 출력합니다.

두번째 줄에는 그러한 도시들의 번호를 오름차순으로 공백으로 구분하여 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

어떤 부 도로 $(u, v, w)$가 있을 때, 주 도로만을 사용하여 $u$에서 $v$로 가는 경로의 폭 $W$가 $w$ 이상이라면,
$u$에서 $v$로 가는 간선 대신 주 도로를 통해서 가는 경로를 사용하였을 때 절대 손해를 보지 않으므로 아무 문제가 없습니다.
그러나 $W < w$이면, 도로의 폭이 $W$를 초과하는 주 도로만으로 이루어지는 연결 요소들을 생각했을 때, $u$가 속한 연결 요소와 $v$가 속한 연결 요소에 들어있는 모든 도시는 로마가 될 수 없게 됩니다.
(한쪽 연결 요소에 속하는 도시를 로마라고 가정하면 반대쪽 연결 요소에 주 도로만으로 가는 경로의 폭은 $W$이지만 대신 $(u, v)$를 통과하는 경로의 폭은 $w$가 되므로 모순입니다.)

각각의 부 도로에 대해 그러한 $W$를 구하기 위해서는, static 경로 최솟값 쿼리를 하면 되며, 스파스 테이블이나 ETT 등을 사용할 수 있습니다.

그 다음에는 부 도로들을 $W$의 내림차순으로 정렬한 뒤, $W$를 초과하는 주 도로들만이 연결되었을 때 $u$와 $v$가 속한 집합을 답에서 모두 제외하는 쿼리를 처리할 수 있으면 문제를 해결할 수 있습니다.
이를 구현하는 한 가지 방법은 다음과 같습니다.

* DSU 자료구조에 `marked`라는 배열을 두고 `false`로 초기화합니다. Union by rank나 union by size는 구현하지 않습니다.
* 어떤 정점 $u$를 받아 $u$가 속한 연결 요소의 모든 정점을 답에서 제외하는 `mark` 함수는 `marked[find(u)] = true;`와 같이 구현합니다.
* `find` 함수에서 경로 압축을 구현하는데, $u$의 조상들 중 가장 마지막으로 marked인 것 $v$를 기준으로 그 전까지는 parent를 $v$로 바꾸고, $v$부터 나머지는 parent를 root로 바꿉니다.
* `union` 함수에서는 두 root 중에서 marked가 아닌 것이 있으면 그것이 root가 되도록 합니다.

{{< /details >}}
