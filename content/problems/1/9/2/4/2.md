---
params:
  boj: 19242
  bojTitle: 행렬 합
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

먼저 $M$이 $N$보다 유의미하게 작으므로, 길이 $M$의 배열 $A$에서 합이 $x$ 이하인 부분 배열의 수를 구하는 것을 $\frac{M^2}{2}$개의 가로 범위에 대해 반복하는 것을 생각해볼 수 있습니다.

각 구간에 대해 sum, sorted prefix sums, sorted suffix sums를 유지하면서 머지 소트를 해 가면서 개수를 세는 방법이 있는데, 상수가 매우 커서 서브태스크 2에서 시간 초과를 받습니다.

이를 작은 상수로 해결하려면 다음과 같은 방법이 있습니다.

* $A$의 누적 합을 구하고, 이 누적합 배열의 인덱스를 누적합의 값으로 정렬합니다. 이 배열을 $S$라고 합시다.
* 구간 합의 왼쪽 인덱스가 $i$, 오른쪽 인덱스가 $j$일 때 구간 합이 $x$ 이하인 것은 $A[j] - A[i] \le x$이므로, $A[j] \le A[i] + x$로 쓸 수 있습니다.
* 실제 $A$에서의 위치에 상관없이 $A[S[j]] \le A[S[i]] + x$를 충족하는 최대 $j$를 모든 $i$에 대해서 투 포인터를 이용하여 구할 수 있습니다. $i$를 증가시켜 가면서, 범위 내의 $S[j]$들 위치에 1을 쓰고 나머지에 0을 쓰는 비트셋을 만듭니다.
* 이제 각 $i$에 대해 $i$보다 큰 인덱스 범위에서의 1의 개수를 `__builtin_popcount`를 사용하여 효율적으로 세어주면 됩니다.

{{< /details >}}
