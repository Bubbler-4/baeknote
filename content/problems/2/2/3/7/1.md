---
params:
  boj: 22371
  bojTitle: Rebound Sequences
---

## 문제 내용

어떤 길이 $n$의 수열 $a_1, a_2, \cdots, a_n$이 다음 조건을 충족하면 **리바운드 수열**이라고 합니다.

* 세 정수 $1 \le i < j < k \le n$가 존재하여 $a_i > a_k > a_j$를 충족합니다.

길이 $n$의 수열 $s$가 주어집니다. $s$의 원소들의 순서를 바꿔서 만들 수 있는 서로 다른 리바운드 수열의 개수를 구하세요.

### 입력

첫 줄에는 $n$이 주어집니다. ($1 \le n \le 200$)

다음 줄에는 정수 $s_1, s_2, \cdots, s_n$이 주어집니다. ($1 \le s_i \le 10^9$)

### 출력

문제의 정답을 $10^9 + 7$로 나눈 나머지를 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

리바운드 수열을 세는 것은 어려울 것 같으니, 리바운드 수열이 아닌 수열을 세어 봅시다.

$s$에서 가장 큰 원소의 오른쪽에 있는 모든 원소는 (같은 값들을 제외하고) 단조감소하여야 함을 알 수 있습니다.
가장 큰 원소를 제외하고 남은 자리에 있는 수들 중에서 가장 큰 원소를 생각하면, 이 조건이 반복됩니다.

따라서, 가장 큰 수부터 하나씩 배치하면서 DP 상태를 (자유롭게 둘 수 있는 자리의 개수)와 (단조감소하여야 하는 자리의 개수)의 쌍으로 나타낼 수 있습니다.
여기서 두 수의 합은 아직 배치하지 않은 수의 개수와 동일하므로, 이 DP의 상태의 개수는 $\mathcal{O} (n^2)$입니다.

이제 DP의 전이식을 정의해 봅시다. 같은 상태를 중복으로 세는 것을 방지하기 위해, 같은 수가 여러 개일 때 그 수를 자유로운 자리에 적어도 한 번 배치했다면 같은 수를 단조감소 자리에 배치할 수 없게 처리할 수 있습니다.
이에 따라 DP 테이블을 두 벌을 만들어서, `DP1`을 자유로운 자리에 한 번도 배치하지 않은 경우의 수, `DP2`를 적어도 한 번 배치한 경우의 수라고 합시다.

* `DP1[a][b]`에서 다음 수를 단조감소 자리에 배치하면 `DP1[a][b-1]`로 전이됩니다. 단, `b = 0`이면 전이할 곳이 없습니다.
* `DP1[a][b]` 또는 `DP2[a][b]`에서 다음 수를 오른쪽에서 `i`번째 자유로운 자리 ($1 \le i \le a$)에 배치하면 `DP2[a-i][b+i-1]`로 전이됩니다.
* 다음 수가 이전 수와 다른 값이라면, `DP2[a][b]`의 모든 값을 `DP1[a][b]`에 더해 주고 `DP2[a][b]`의 값을 0으로 둡니다.

이렇게 DP를 진행한 결과의 `DP1[0][0]`과 `DP2[0][0]`의 합이 리바운드 수열이 아닌 수열의 개수가 됩니다. 이제 전체 수열의 개수를 multinomial로 구해서 앞에서 구한 값을 빼 주면 됩니다. 모듈로 계산에 주의합니다.

{{< /details >}}
