---
params:
  boj: 22992
  bojTitle: 다꾸
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

어떤 사각형의 테두리는 네 개의 가로줄 또는 세로줄 영역으로 나눌 수 있습니다. 그리고 그 테두리에서 어떤 연속적인 영역을 제거한 것들을 고려하려면, 각 가로줄과 세로줄 영역에서 하나의 연속적인 영역을 제거하는 모든 방법을 고려해야 합니다.

이를 해결하기 위해, 다음과 같은 정보를 포함하는 세그먼트 트리 노드를 만듭니다.

* sum: 구간 합
* prefix sum max: 첫 칸을 포함하고 마지막 칸을 제외한 구간의 합 중 최댓값
* suffix sum max: 첫 칸을 제외하고 마지막 칸을 포함한 구간의 합 중 최댓값
* infix sum max: 첫 칸과 마지막 칸을 제외한 연속 구간의 합 중 최댓값
* outfix sum max: 첫 칸과 마지막 칸을 포함하고 중간의 어떤 1칸 이상의 연속 구간을 제외한 합 중 최댓값

각각의 값을 줄여서 `s, pm, sm, im, om`이라고 합시다.

두 구간의 합성은 다음과 같이 할 수 있습니다.

```
s = s1 + s2
pm = max(pm1, s1, s1 + pm2) // 순서대로 왼쪽의 부분, 왼쪽 전체, 왼쪽 전체 + 오른쪽의 부분
sm = max(sm1 + s2, s2, sm2) // 순서대로 왼쪽의 부분 + 오른쪽 전체, 오른쪽 전체, 오른쪽의 부분
im = max(im1, im2, sm1, pm2, sm1 + pm2) // 순서대로 왼쪽의 내부, 오른쪽의 내부, 왼쪽의 마지막 포함 오른쪽 시작 제외, 왼쪽 마지막 제외 오른쪽 시작 포함, 왼쪽 마지막과 오른쪽 시작 포함
om = max(om1 + s2, s1 + om2, pm1 + sm2, pm1 + s2, s1 + sm2) // 순서대로 왼쪽의 외부 + 오른쪽 전체, 왼쪽 전체 + 오른쪽의 외부, 왼쪽 마지막과 오른쪽 시작 제외, 오른쪽 시작만 포함, 왼쪽 마지막만 포함
```

정의를 잘 읽어보면, `pm, sm`은 현재 구간의 길이가 1인 경우, `im, om`은 길이가 2 이하인 경우 정의되지 않습니다. 이를 해결하기 위해 초기값은 적당히 큰 음수 (ex. $-10^{12}$)로 둡니다. 이렇게 하면 구간 합성을 반복하여 길이가 3 이상이 되면
정상적인 정보를 담고 있게 됩니다.

가로와 세로 영역의 4개의 쿼리 결과를 계산한 다음에는 이들을 합성해야 하는데, 이것도 사실 그냥 동일한 연산으로 합성하면 됩니다.

```goat
+------------------------+---+
|          1 -->         |   |
+---+--------------------+   |
|   |                    | 2 |
|   |                    |   |
|   |                    | | |
| ^ |                    | v |
| | |                    |   |
|   |                    |   |
| 4 |                    |   |
|   +--------------------+---+
|   |          <-- 3         |
+---+------------------------+
```

위의 그림에서 1, 2, 3, 4번 영역을 쿼리한 결과를 두고, 3번과 4번의 앞뒤를 뒤집어서 1, 2, 3, 4 순서대로 합성을 해 주면 되는데, 뒤집는 것은 `pm`과 `sm`만 서로 바꿔주면 됩니다.
그리고 나서 최종 합성한 결과에 포함된 다섯 개의 수 중에서 최댓값을 쿼리의 답으로 출력하면 됩니다.

{{< /details >}}
