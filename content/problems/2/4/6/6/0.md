---
draft: true
params:
  boj: 24660
  bojTitle: High Powers
---

## 문제 내용

$n, m, s, t, u$의 값이 주어질 때, $a + b + c = s$, $ab + bc + ca = t$, $abc = u$를 충족하는 세 수 $a, b, c$에 대해 지문에 주어진 수식의 값을 $998\;244\;353$으로 나눈 나머지를 구하세요.

### 입력

첫 줄에 $n, m$이 주어집니다.

두 번째 줄에 $s, t, u$가 주어집니다.

## 문제 풀이

{{% details title="스포일러" closed="true" %}}

$a + b + c = s$, $ab + bc + ca = t$, $abc = u$라는 것은 삼차방정식 $x^3 - sx^2 + tx - u = 0$의 세 근이 $a, b, c$라는 의미입니다. 따라서 $a^3 - sa^2 + ta - u = 0$ 등이 성립합니다.

이제 지문에 주어진 수식의 값을 $f(n, m)$으로 두고 작은 $n$과 $m$을 넣어보면 다음과 같은 관찰을 할 수 있습니다.

* $f(n, 0) = f(0, m) = 0$ ($m = 0$이면 분자의 각각의 괄호 안이 0, $n = 0$이면 $x^m$ 항들이 각각 상쇄됨)
* $f(n, n) = 0$ ($m = n$이면 $a^n b^n$과 $b^n a^n$ 등이 각각 상쇄됨)
* $f(1, 2) = 1$, $f(2, 1) = -1$

그러나 조금만 더 큰 $n$과 $m$을 넣어봐서는 규칙을 찾기가 어렵습니다. 여기서 삼차방정식을 이용해 $a^n$을 $Aa^2 + Ba + C$ 꼴로 만드는 아이디어를 사용합니다.

$a^3 - sa^2 + ta - u = 0$을 다르게 쓰면 $a^3 = sa^2 - ta + u$입니다. 따라서 $a^n$을 반복적으로 치환하면 위의 꼴이 나올 것이라고 추측할 수 있는데, 단순히 그렇게 구현하기에는 $n$이 너무 큽니다.
이를 해결하기 위해 $a^1$에서 시작하여 $a^{2^k}$를 반복적으로 구하는 분할정복 거듭제곱을 사용할 수 있습니다. (키타마사의 구현과 사실상 같습니다.)

이렇게 $a^n = Aa^2 + Ba + C$와 $a^m = A'a^2 + B'a + C'$를 구했으면, $f(n, m)$의 분자를 잘 묶어서 $0 \le i, j \le 2$에 대해 $f(i, j)$의 선형 결합으로 나타낼 수 있습니다.
$f(1, 2)$와 $f(2, 1)$을 제외하면 모두 0이므로 문제의 답을 간단한 수식으로 구할 수 있습니다.

{{% /details %}}
