---
params:
  boj: 25102
  bojTitle: Airline
---

## 문제 내용

$n$개의 정점을 가진 트리가 주어집니다. 정점 $s$에서 정점 $t$로 가기 위해 거쳐야 하는 간선의 최소 개수를 두 정점 간의 거리라고 합니다. 다음의 쿼리 $q$개를 처리하세요.

* `s t`: 이 트리에서 정점 $s$와 $t$ 사이에 간선을 하나 추가했을 때 거리가 감소하는 정점의 쌍의 개수를 출력합니다. 이 간선은 실제로 추가되지 않으며, 따라서 이후의 쿼리에 영향을 주지 않습니다.

### 입력

첫 줄에는 정점의 개수 $n$과 쿼리의 개수 $q$가 주어집니다. ($2 \le n \le 10^6$, $1 \le q \le 10^5$)

다음 $n-1$줄에는 트리의 간선의 목록이 주어집니다.

다음 $q$줄에는 쿼리가 주어집니다. 모든 쿼리에서 $s$와 $t$ 간의 거리의 합은 $10^7$을 초과하지 않습니다.

### 출력

각 쿼리에 대해 답을 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

어떤 쿼리에 대해 $s$와 $t$ 사이의 거리가 $d$라면, 그러한 경로 상의 정점들을 $a_0 (=s), a_1, \cdots, a_{d-1}, a_d (=t)$로 둘 수 있습니다. $s$와 $t$ 사이에 간선을 하나 추가하면 이 경로는 사이클이 되며,
이때 이 경로 상의 정점들 중 거리가 감소하는 정점의 쌍은 $i + \frac{d+1}{2} < j$인 $(a_i, a_j)$의 쌍이 됩니다.

그리고 경로 상에 있지 않은 정점들의 쌍 사이의 최단 경로에서 사이클 밖의 부분은 바뀌지 않으므로, 그러한 정점들을 모두 가장 가까운 경로 상의 정점과 똑같이 생각하고 그 개수로 대체할 수 있습니다.

트리의 정점들 중에서 경로 상의 정점 중 가장 가까운 점이 $a_i$인 정점의 개수를 $b_i$라고 하고, $m = \lfloor\frac{d+1}{2}\rfloor + 1$로 두면, 쿼리의 답은 $b_0 \sum_{i=m}^{d} b_i + b_1 \sum_{i=m+1}^{d} b_i + \cdots$입니다.

거리의 합 조건으로 인해 각각의 $b_i$를 상수 시간에 구할 수 있으면 답을 구할 수 있고, LCA를 sparse table 없이 나이브하게 구하는 것이 구현하기 편합니다.
$a_i$들 중에서 하나는 $s$와 $t$의 LCA이며, LCA 또는 그 왼쪽에 있는 $a_i$에 대해 $b_i$의 값은 각 노드를 루트로 하는 서브트리의 크기 $s_i$를 알 때 다음과 같이 구할 수 있습니다. 오른쪽은 대칭적으로 구합니다.

* $a_0$이 LCA인 경우, $b_0 = n - s_{a_1}$
* $a_0$이 LCA가 아닌 경우, $b_0 = s_{a_0}$
* $a_i$ ($i > 0$)이 LCA인 경우, $b_i = n - s_{a_{i-1}} - s_{a_{i+1}}$
* $a_i$ ($i > 0$)이 LCA가 아닌 경우, $b_i = s_{a_i} - s_{a_{i-1}}$

$b_i$들을 모두 구했으면 쿼리의 답은 누적 합을 이용해 $\mathcal{O}(d)$ 시간에 구할 수 있습니다.

{{< /details >}}
