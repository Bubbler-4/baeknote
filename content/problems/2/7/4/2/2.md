---
params:
  boj: 27422
  bojTitle: Remodeling the Dungeon
---

## 문제 내용

세로 길이 $h$, 가로 길이 $w$의 사각 격자가 있습니다. 상하좌우로 이웃한 두 칸 사이로 이동할 수 있지만, 어떤 두 칸 사이에는 벽이 있어 서로 이동할 수 없습니다.
벽들은 격자 내의 모든 두 칸 사이에 정확히 하나의 단순 경로가 존재하도록 세워져 있습니다. 즉, 이 미로는 트리입니다.

이제 벽을 하나 제거하고 벽을 하나 세워서 맨 왼쪽 위 칸에서 맨 오른쪽 아래 칸으로 가는 단순 경로의 길이를 최대화하려고 합니다.
벽을 제거하고 세운 결과도 트리 구조여야 할 때, 얻을 수 있는 최대 길이를 구하세요. 경로의 길이는 그 경로가 거친 칸의 개수로 정의합니다.
벽을 제거한 곳에 벽을 다시 세워도 됩니다.

### 입력

첫 줄에는 $h$와 $w$의 값이 주어집니다. ($2 \le h, w \le 500$)

다음 $2h+1$줄에는 각각 $2w+1$글자의 문자열이 주어집니다. 입력 형식은 예제를 참고하세요.

### 출력

문제의 정답을 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

벽을 하나 제거하면 사이클이 하나 만들어지며, 사이클의 다른 부분에 벽을 세워서 트리를 유지할 수 있습니다.
따라서 각 칸에 대해 출발점과 도착점에서의 거리를 모두 계산해 놓으면, 칸 $x$와 칸 $y$ 사이의 벽을 제거하여 얻을 수 있는 최대 길이는 시작점에서 $x$의 거리와 도착점에서 $y$의 거리의 합, 또는 시작점에서 $y$의 거리와 도착점에서 $x$의 거리의 합이라고
추정할 수 있습니다.

일반적인 경우, 두 값을 계산해 보면 두 값이 서로 다릅니다. 하나는 최단 경로가 맞고, 다른 하나는 사이클을 한 번 빙글 돌아서 도착점으로 들어가는 경로가 되기 때문입니다.

그러나 모든 벽에 대해 이러한 두 값 중 최솟값의 최댓값을 출력하게 하면 예제 3이 올바르게 나오지 않습니다. 이는 하나의 막다른 길 내의 벽을 뚫게 되면 두 경로 모두 단순 경로가 아니게 되기 때문입니다.
(시작점 - 단순 경로의 중간 지점 - 이탈 - 사이클 - 이탈 경로를 반대로 이동 - 도착점)
이러한 경우에는 두 경로의 길이가 같게 나오므로, 이러한 경우를 제외해 주면 정답이 됩니다.

{{< /details >}}
