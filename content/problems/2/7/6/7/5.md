---
params:
  boj: 27675
  bojTitle: Dijkstra's Nightmare (Hard)
---

## 문제 내용

양의 정수 $p$가 주어집니다. ($1 \le p \le 10^7$)
[27676번 문제](https://www.acmicpc.net/problem/27676)의 "입력"란에 있는 Dijkstra 알고리즘의 구현체를 보고, 그 구현체가 정확히 $p$개의 정점을 방문하도록 하는 그래프를 아무거나 하나 출력하세요.

### 입력

첫 줄에는 테스트 케이스의 개수 $T$가 주어집니다. 그 다음에는 $T$개의 $p$의 값이 순서대로 주어집니다. 각 $p$값 이전에는 빈 줄이 하나씩 있습니다.
테스트 데이터는 한 개이며, 본문의 "입력"란에 있는 `d2.in` 링크에서 확인할 수 있습니다.

### 출력

각각의 $p$값에 대해, 다음의 조건을 충족하는 그래프를 하나 찾아 출력합니다.

* 정점의 개수 $n$은 1 이상 60 이하입니다.
* 각 간선의 가중치는 $-2^{31}$ 이상 $2^{31}$ 미만입니다.
* 각 정점의 번호는 0부터 $n-1$까지의 정수입니다.
* Dijkstra 알고리즘의 시작점은 0번 정점입니다.
* 이 그래프에서 Dijkstra 알고리즘을 돌렸을 때, 정점을 정확히 $p$번 방문합니다.

그래프는 다음과 같은 형식으로 출력합니다.

* 첫 줄에는 정점의 개수 $n$을, 다음 줄에는 간선의 개수 $m$을 출력합니다.
* 그 다음 $m$줄에 걸쳐서 각 줄에 하나의 간선의 정보를 출발점, 도착점, 가중치의 순서로 공백으로 구분하여 출력합니다.

## 문제 풀이

{{% details title="기본 아이디어" closed="true" %}}

먼저, 방문 정점의 수를 지수적으로 증가시키기 위해서는 정점을 가능한 한 적게 추가하여 기존의 모든 정점을 중복하여 방문하게 하여야 합니다.
그리고 단순히 정점을 중복 방문하는 것이 아니라, 기존의 방문 순서를 정확히 그대로 두 번 따르게 해야 합니다.

이는 다음과 같은 구성으로 달성할 수 있습니다.

```
0 ----> 2 -> ...
|  +x   ^
|       |
\-> 1 --/
+y     -z
```

0번 정점과 1번 정점을 추가하고, 원래 그래프의 정점 번호에 모두 2를 더합니다. 그리고 $0 \rightarrow 2$에 적당한 가중치 $x$를 두어 먼저 기존 그래프가 한 번 방문되도록 합니다.

그다음, $0 \rightarrow 1$에 충분히 큰 가중치 $y$를 두어 기존 그래프에서 가장 먼 점의 거리보다 크게 하면, 기존 그래프의 모든 정점이 방문된 이후에 1번 정점이 방문됨을 보장할 수 있습니다.
그다음 $1 \rightarrow 2$에 충분히 큰 음의 가중치 $z$를 두어 $y-z < x$가 되게 하면 2번 정점의 거리가 업데이트되면서 기존 그래프 전체를 한 번 더 방문하게 됩니다.

이렇게 하였을 때, 기존 그래프의 방문 횟수가 $a$라면 새로운 그래프의 방문 횟수는 $2a+2$입니다. Base case로서 방문 횟수 1, 2, 3인 선형 그래프를 두고,
$p$가 홀수일 때는 맨 앞에 정점을 하나만 추가하는 동작을 해 주면 원하는 $p$를 만들 수 있는 구성이 완성됩니다.

{{% /details %}}

{{% details title="가중치 잡기" closed="true" %}}

위 구성에서, 2번 노드는 처음에 $x$의 거리를 가졌다가 $y-z$로 업데이트됩니다. 그 차이는 $d = x-(y-z)$입니다.
이 차이를 모든 위치에서 똑같게 두면 뒤쪽 부분 그래프의 재방문이 제대로 이루어지지 않음을 관찰할 수 있고, 따라서 점점 증가하게 두어야 함을 알 수 있습니다.

그런데 단순히 $d$가 증가하는 것으로도 부족합니다. 정확한 조건은 **새로운 $d$가 모든 기존 그래프에서 사용된 $d$의 합보다 커야 한다**입니다.
이는 첫 번째 방문에서 업데이트가 완료된 마지막 노드의 거리가 최초의 거리에서 이전 $d$의 합을 뺀 것이고, 다음 방문의 최초 업데이트에서 그것보다 더 작은 거리를 달성해야 하기 때문입니다.

$x$의 값은 각각의 가중치가 범위 내에 들어오게 만드는 것 외에는 크게 신경쓰지 않아도 됩니다.

여기까지 구성하고 실제로 그래프를 구성해 보면, 50개의 모든 주어진 $p$값에 대해 제한 범위 이내의 그래프를 구할 수 있습니다.
$5242877$ 같은 입력을 넣으면 정점의 개수가 아슬아슬하게 초과되지만 다행히 그런 입력은 없기 때문에 그대로 내면 통과합니다.

{{% /details %}}
