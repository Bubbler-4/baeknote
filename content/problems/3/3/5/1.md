---
params:
  boj: 3351
  bojTitle: 삼각 분할
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

절단선이 어떤 삼각형의 내부를 뚫고 지나가면 다른 조각으로 분리되는 같은 색의 두 점이 발생할 수밖에 없으니, 절단선은 삼각형들의 변들을 따라서만 그릴 수 있습니다.

삼각형마다 정점을 하나씩 만들고, 두 삼각형이 변을 공유할 때 해당 정점들 사이에 간선을 그리면, 얻어지는 그래프는 트리임을 귀납적으로 증명할 수 있습니다. 따라서 정점마다 색이 칠해진 트리가 주어졌을 때, 색이 같은 두 정점을 잇는 경로들은 모두 보존해야 한다는 조건 하에 최대한 많은 간선을 끊는 문제로 바뀝니다.

트리의 루트를 마음대로 정했을 때, 정점 $u$와 그 부모 사이의 간선을 끊을 수 있는 필요충분조건은 모든 색이 $u$의 서브트리 안에만 있거나 밖에만 있는 것입니다. 한 가지 구현 방법은 서브트리마다 $<\text{색 : 그 색의 정점 개수}>$를 저장하는 set을 smaller to larger 방식으로 합치면서 한 색의 정점이 전부 모이는 순간 set에서 제거해 주고, set이 공집합이 되는 서브트리들을 세 주면 됩니다. 루트는 당연히 공집합이 되지만 부모가 없으니 세지 않도록 주의합니다. 이 풀이의 시간 복잡도는 $O(n \log n)$입니다.

LCA를 이용해서 구현할 수도 있습니다. 각 정점마다 초기값이 $0$인 "점수"를 정의하고, 각 색 $c$마다 색이 $c$인 정점 개수를 색이 $c$인 정점들 전체의 LCA의 점수에 더해 줍니다. 그러면 서브트리 속의 점수의 총합이 서브트리의 크기와 일치하는 정점만이 부모와의 간선을 끊을 수 있습니다. 이 풀이의 시간 복잡도도 $O(n \log n)$로 같으나, LCA를 $O(1)$으로 구현하면 첫 번째 풀이보다 실제 속도가 빠를 수 있습니다.

{{< /details >}}