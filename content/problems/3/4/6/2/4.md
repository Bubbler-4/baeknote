---
params:
  boj: 34624
  bojTitle: 제식 훈련 2
---

## 문제 내용

생략

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

어떤 칸이 특정 방향을 가리키고 있다면, 그 칸의 앞에 줄지어 있는 모든 칸을 묶어서 하나의 일자 폴리오미노로 생각할 수 있습니다.
그러면 $N \times M$의 격자를 길이 1인 변이 바깥 테두리에 있도록 일자 폴리오미노로 덮는 것으로 해석할 수 있습니다.

이제 이렇게 덮은 결과가 다음의 특성을 항상 가짐을 증명합니다.

* 덮은 결과는 항상 가로 직선이나 세로 직선 중 하나로 깔끔하게 나눠집니다.

먼저, 적어도 하나의 가로줄이 `W*E*` 꼴이거나 하나의 세로줄이 `N*S*` 꼴이라면 명제가 성립합니다.
그러한 줄이 없다고 가정하면, 다음과 같은 소용돌이 문양 또는 그 대칭 모양이 반드시 존재합니다.

```
.N....
.NEEEE
.N..S.
.N..S.
WWWWS.
....S.
```

그런데 그 내부의 면적이 0이 아니라면, 그 안에 든 칸에서는 N, S, E, W 어느 쪽으로도 확장해서 바깥 테두리에 닿을 수 없으므로, 그 면적은 0일 수밖에 없고,
이는 그 영역의 가로 또는 세로 길이가 0이라는 의미입니다. 가로가 0이면 N의 경계와 S의 경계를 이어서 세로 직선을 하나 그을 수 있고, 세로가 0이면 마찬가지로 가로 직선을 그을 수 있습니다.

이제 해당 가로 직선이나 세로 직선으로 나눠서 생각할 수 있습니다. 편의상 가로 직선의 위쪽 영역을 생각해 봅시다. (나머지 경우는 대칭적으로 처리해주면 됩니다.)

가로 직선의 위에서는 S가 올 수 없으므로, W, E, N만 올 수 있습니다. 이 영역을 채우는 방법은 다음의 2가지로 나눌 수 있습니다.

* 맨 아래 가로줄을 `W*E*`로 채우고, 나머지를 W, E, N으로 채웁니다.
* 맨 아래 가로줄 중 한 칸에 N을 놓습니다.

두 번째의 경우, 그러한 N은 영역의 맨 위까지 뻗어야 하고, 따라서 직선 위의 영역은 그 N에 의해 왼쪽과 오른쪽 영역으로 나눠집니다.
이제 그렇게 나눠진 왼쪽과 오른쪽은 각각 N과 W, N과 E만 올 수 있음을 관찰할 수 있습니다.

이제 N과 W만으로 맨 왼쪽 위 칸을 포함하는 직사각형 영역을 덮는 최소 비용을 구하면 되고 (나머지는 역시 대칭적으로 처리), 이는 각 칸을 N이나 W의 시작점으로 만들기 위해 필요한 비용을 구한 뒤에,
2차원 DP로 구할 수 있습니다.

여기까지 왔으면 이 모든 요소를 역순으로 구현하여 답을 구하면 됩니다.

{{< /details >}}
