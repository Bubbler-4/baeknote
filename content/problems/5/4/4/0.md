---
params:
  boj: 5440
  bojTitle: In and Out
---

## 문제 내용

정점이 $N$개, 간선이 $M$개인 가중치 무방향 그래프가 주어집니다. 특정 정점들을 두 번 이상 방문하지 않고 1번 정점에서 시작하여 $N$번 정점을 거쳐 1번 정점으로 돌아오려고 합니다.
이때 그러한 경로 중에서 가중치 합이 가장 작은 것을 찾아 그때의 가중치 합을 출력하세요.

### 입력

첫 줄에는 테스트 케이스의 개수가 주어집니다.

각 테스트 케이스에 대해, 첫 줄에는 그래프의 정점의 개수 $N$과 간선의 개수 $M$이 주어집니다. ($1 \le N \le 1000$, $1 \le M \le 10\;000$)
이 그래프에는 **multiple edges**가 있을 수 있습니다.

그다음 $M$줄에 걸쳐서 그래프의 간선의 정보가 세 개의 정수 $a$, $b$, $\ell$로 주어집니다. ($1 \le a, b \le N$, $1 \le \ell \le 1000$) 이는 정점 $a$와 정점 $b$를 잇는 가중치 $\ell$의 무방향 간선을 나타냅니다.

다음 줄에는 두 번 이상 방문할 수 없는 정점의 개수 $S$가 주어지며, 그 다음 줄에는 $S$개의 서로 다른 정점 번호가 주어집니다. ($0 \le S \le \min(N-2, 100)$) 이 목록에는 1번과 $N$번은 주어지지 않습니다.

### 출력

각 테스트 케이스에 대해, 문제의 조건을 충족하는 경로가 존재한다면, 가중치 합의 최솟값을 출력합니다. 존재하지 않는다면, `No safe route`를 대신 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

이 문제는 MCMF로 풀 수 있습니다. 문제에서 요구하는 경로는 1번 정점에서 시작하여 $N$번 정점으로 가는 두 개의 경로를 요구하는 것과 같습니다.
정점의 방문 횟수 제한은 정점을 in과 out으로 분할한 뒤 그 사이의 간선의 용량을 1로 설정하는 것으로 처리할 수 있습니다.
시작점으로 들어가는 간선을 만들어 용량을 2로 설정해 주고 각 간선의 비용을 그 간선의 가중치로 설정하면, 유량 2의 최소 비용 플로우의 비용이 문제의 정답이 됩니다.
유량 2의 플로우가 존재하지 않으면 답은 존재하지 않습니다.

Multiple edges를 미리 처리해두지 않으면 다음과 같은 입력이나 간선 순서를 바꾼 것에서 오답이 나올 수 있습니다.

```
1
2 2
1 2 5
1 2 10
0
```

이 입력의 정답은 10입니다.

{{< /details >}}
