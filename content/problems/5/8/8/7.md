---
params:
  boj: 5887
  bojTitle: Large Banner
---

## 문제 내용

좌표평면 상에 $x = 0, 1, 2, \cdots, M$과 $y = 0, 1, 2, \cdots, N$에 대해 모든 $(x, y)$의 위치에 점이 찍혀 있습니다.

두 개의 서로 다른 점을 골라서 그 사이에 선분을 그렸을 때, 선분의 길이가 $L$ 이상 $H$ 이하이고 그 선분 위에 다른 점이 없는 경우의 수를 $B$로 나눈 나머지를 구하세요. 서로 같은 두 점을 순서만 다르게 고른 것은 한 가지 경우로 계산합니다.

### 입력

첫 줄에 $M$, $N$, $L$, $H$, $B$의 값이 순서대로 주어집니다. ($1 \le M, N \le 100\;000$, $1 \le L \le H \le 150\;000$, $1 \le B \le 10^9$) 모든 값은 정수입니다.

### 출력

문제의 정답을 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

먼저, $L$ 이상 $H$ 이하의 길이 조건은 $H$ 이하인 것과 $L$ 미만인 것을 구해서 둘을 빼 주면 되므로, 상한만 있는 경우로 단순화할 수 있습니다.

그리고 가로 좌표 차이 $\Delta x$와 세로 좌표 차이 $\Delta y$를 고정하면 그에 해당하는 선분의 개수는 상수 시간에 구할 수 있고, 조건에 의해 $\Delta x$와 $\Delta y$가 서로소여야 함을 알 수 있습니다.

서로소 조건을 해결하기 위해 뫼비우스 반전을 사용한다고 치면, 서로소 조건이 없는 경우의 수를 $i = 1, 2, \cdots$에 대해 $\Delta x$와 $\Delta y$가 모두 $i$의 배수일 때에 대해 각각 구할 수 있으면 됩니다.

길이가 $H$ 이하인 것은 $\Delta x^2 + \Delta y^2 \le H^2$로 나타낼 수 있습니다. $\Delta x$를 고정하면 가능한 최대 $\Delta y$를 알 수 있으며, 그 $\Delta x$에 대해 가능한 모든 $\Delta y$에 대한 경우의 수의 합은
적절히 식을 정리하여 상수 시간에 구할 수 있습니다. 이렇게 구하면 $i = 1$에 대해 경우의 수를 구하는 시간은 $\mathcal{O} (M)$입니다.
$i > 1$의 경우에도 동일하게 $\Delta x$를 범위 내의 모든 $i$의 배수로 두고 구하면 되며, 이때 모든 $i$에 대해 고려해야 하는 $\Delta x$의 개수는 총 $\mathcal{O} (M \log M)$이 됩니다.

이제 앞에서 말한 대로 뫼비우스 반전을 하여 서로소인 경우에 대한 답을 구하면 됩니다.

{{< /details >}}
