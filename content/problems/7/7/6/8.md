---
params:
  boj: 7768
  bojTitle: Parabolic teleports
---

## 문제 내용

평면에 $N$개의 포물선 모양 텔레포트가 설치되어 있습니다. 각 포물선은 다섯 개의 값 $A, B, C, L, R$에 의해 결정되며, $L \le x \le R$ 범위에서 $y = Ax^2 + Bx + C$ 모양을 갖습니다.

한 텔레포트의 어떤 점에 도달하면 그 텔레포트 위의 다른 아무 점으로 순간이동할 수 있습니다. 이때, 출발점 $(X_V, Y_V)$에서 도착점 $(X_W, Y_W)$까지의 최단 거리를 구하세요.

### 입력

첫 번째 줄에 텔레포트의 개수 $N$이 주어집니다. ($0 \le N \le 100$)

두 번째 줄에는 출발점의 좌표 $X_V$와 $Y_V$가 주어지고, 세 번째 줄에는 도착점의 좌표 $X_W$와 $Y_W$가 주어집니다. ($-100 \le X_V, X_W \le 100$, $-10^6 \le Y_V, Y_W \le 10^6$)

네 번째 줄부터 $N$줄에 걸쳐서, 각 줄마다 하나의 텔레포트의 파라미터가 $A, B, C, L, R$ 순으로 주어집니다. ($-100 \le A, B, C, L, R \le 100$, $A \ne 0$, $L < R$)

### 출력

문제의 정답을 출력합니다. 실제 정답과 절대 오차가 $10^{-4}$ 이하이면 정답으로 인정됩니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

점과 포물선 간의 최단 거리와 두 포물선 사이의 최단 거리를 구할 수 있으면, 그 뒤에는 아무 최단 거리 알고리즘을 사용하여 문제를 풀 수 있습니다.

먼저 점과 포물선 간의 최단 거리를 구하기 위해서는, 포물선 상의 점의 $x$좌표에 대해 거리의 제곱을 전개한 4차식의 최솟값을 구해야 합니다.
이는 그 식의 미분을 0으로 둬서 구한 극값들과 포물선의 양쪽 끝점에서의 값들을 비교하여 그 중 최소를 고르면 됩니다.
삼차방정식을 풀기 위해서는 근의 공식을 쓸 수도 있지만, 그것의 미분을 0으로 하는 이차방정식을 풀어 극값들의 위치로 나눠지는 3개의 구간에서 각각 이분 탐색을 수행하여 풀 수도 있습니다.

포물선과 포물선 간의 최단 거리는 알려진 올바른 풀이가 **없습니다**. 무한한 두 포물선의 경우는 최단 거리의 양 끝점에서의 기울기가 같다고 놓고 위와 같은 방법으로 풀면 된다고 알려져 있으나,
유한한 경우에는 성립하지 않습니다.

하나의 포물선 위에서 점을 움직이면서 다른 포물선까지의 거리를 그래프로 그려 보면, 극소는 최대 두 개이나 그 모양은 다양하며, 뾰족한 극소와 매우 완만한 극소가 공존하는 경우도 많고,
이 경우 삼분탐색 등으로 올바른 최소를 완벽하게 찾기는 매우 어렵습니다. 지금까지의 AC 코드가 사용한 해결책은 다음과 같으나, 완벽한 방법은 아닙니다.

* 각 포물선을 포물선의 꼭짓점을 기준으로 두 개로 나눈 뒤에 삼분 탐색을 진행합니다. 테스트 케이스는 모두 맞는 것으로 보이지만, 오목한 쪽으로 서로 마주보고 있을 경우 중간에 극대가 있을 수 있어
  잘못된 극소를 고를 가능성이 있습니다.
* 포물선을 적당한 수의 구간으로 나눈 다음 그 중에서 극소가 존재하는 구간을 찾아 그 구간 내에서 삼분 탐색을 진행합니다. 시간이 굉장히 빡빡하여 적당히 작은 수를 골라야 하는데,
  모든 테스트 케이스에서 올바른 극소를 찾으려면 파라미터 선정에서 꽤 많은 운이 필요하고, 테스트 케이스 추가로 틀릴 확률이 매우 높습니다.

{{< /details >}}
