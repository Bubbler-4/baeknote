---
params:
  boj: 9591
  bojTitle: Shopping Malls
---

## 문제 내용

3차원 건물 내부의 여러 개의 점과 그 점들 사이의 이동 수단이 주어집니다. 거리를 실제로 걸어야 하는 거리를 기준으로 측정하였을 때, 여러 개의 점들의 쌍에 대해 한 점에서 다른 점으로 이동하는 최단 경로를 출력하세요.

각 점은 그 점의 층수와 $x, y$ 좌표로 주어집니다. 한 층의 높이는 5미터이며, $x, y$좌표는 미터 단위로 주어집니다.

이동 수단은 걷기(`walking`), 계단(`stairs`), 엘리베이터(`lift`), 에스컬레이터(`escalator`)가 있습니다.

* 걷거나 계단을 이용하는 경우, 두 점 간의 거리는 3차원 유클리드 거리와 같습니다.
* 엘리베이터를 이용하는 경우, 두 점 간의 거리는 1미터로 계산됩니다. 엘리베이터가 여러 층에 걸쳐서 운행하는 경우에는 모든 층의 쌍이 입력에 주어집니다.
* 에스컬레이터를 이용하는 경우, 정방향의 거리는 1미터로 계산되며, 역방향의 거리는 두 점 간의 3차원 유클리드 거리의 3배로 계산됩니다.

모든 점은 적어도 하나의 경로를 통해 서로 연결되어 있습니다.

### 입력

먼저 건물의 정보가 주어집니다. 첫 줄에는 점의 개수 $n$과 두 점 간에 직접 이동하는 방법의 수 $m$이 주어집니다. ($1 \le n \le 200$, $n-1 \le m \le 1000$)

다음 $n$줄에는 각 점의 좌표가 층수 $f$, $x$, $y$좌표 순으로 주어집니다. ($0 \le f \le 5$, $1 \le x, y \le 50$) 모든 입력값은 정수이며, 임의의 두 지점을 직접 연결하는 이동 수단은 최대 한 개입니다.

다음 $m$줄에는 이동하는 방법이 두 점의 번호와 이동 수단을 나타내는 문자열로 주어집니다.

그 다음으로 쿼리가 주어집니다. 먼저 쿼리의 개수 $q$가 주어지며, 다음 $q$줄에는 최단 경로를 구하고자 하는 점의 번호의 쌍이 주어집니다. ($1 \le q \le 1000$)

최단 경로의 이동 거리가 두 번째로 짧은 경로에 비해 충분히 짧은 정점 쌍만이 쿼리로 주어집니다.

### 출력

각 쿼리에 대해, 최단 경로로 이동하기 위해 거쳐야 하는 정점의 번호들을 한 줄에 순서대로 출력합니다.

## 문제 풀이

{{< details title="스포일러" closed="true" >}}

주어진 정보를 이용해 유향 그래프를 구성한 다음, Dijkstra 역추적 또는 Floyd 역추적을 사용하여 답을 구하면 됩니다.

{{< /details >}}
